<!--index.wxml-->
<view class="container">
  <!-- 隐藏的视频播放组件，用于实际播放视频 -->
  <video id="myVideo" style="width: 1px; height: 1px; opacity: 0;"></video>
  
  <!-- 用药提醒/处方台账模块 -->
  <view class="prescription-reminder" wx:if="{{showPrescriptionModule}}">
    <!-- 超管/管理员/同时拥有两种权限的用户，同时显示两个模块 -->
    <view wx:if="{{showBothModules}}">
      <!-- 普通用户用药提醒 -->
      <view class="prescription-reminder-inner">
        <view class="reminder-header">
          <text class="reminder-title">用药提醒</text>
          <text class="reminder-subtitle">即将到用药时间</text>
        </view>
        <view class="reminder-content">
          <view class="reminder-item">
            <text class="reminder-label">上次开药:</text>
            <text class="reminder-value">{{prescriptionInfo.lastDate}}</text>
          </view>
          <view class="reminder-item">
            <text class="reminder-label">用药天数:</text>
            <text class="reminder-value">{{prescriptionInfo.lastDays}}天</text>
          </view>
          <view class="reminder-item">
            <text class="reminder-label">下次开药:</text>
            <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{prescriptionInfo.nextDate}}</text>
          </view>
          <view class="reminder-item" wx:if="{{daysRemaining >= 0}}">
            <text class="reminder-label">剩余天数:</text>
            <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{daysRemaining}}天</text>
          </view>
        </view>
      </view>
      
      <!-- 护工/医师处方台账 -->
      <view class="prescription-reminder-inner">
        <view class="ledger-header">
          <text class="ledger-title">处方台账</text>
          <text class="ledger-subtitle">最近处方记录</text>
        </view>
        <scroll-view class="ledger-list" scroll-y>
          <block wx:if="{{ledgerList.length > 0}}">
            <view wx:for="{{ledgerList}}" wx:key="index" class="ledger-item">
              <text class="ledger-patient">{{item.patientName}}</text>
              <text class="ledger-date">{{item.prescriptionDate}}</text>
              <text class="ledger-status">{{item.status}}</text>
            </view>
          </block>
          <view wx:else class="empty-ledger">
            <text class="empty-text">暂无处方记录</text>
          </view>
        </scroll-view>
      </view>
    </view>
    
    <!-- 普通用户用药提醒 -->
    <view wx:elif="{{userRole === 'normal' || userRole === 'idCard'}}">
      <view class="reminder-header">
        <text class="reminder-title">用药提醒</text>
        <text class="reminder-subtitle">即将到用药时间</text>
      </view>
      <view class="reminder-content">
        <view class="reminder-item">
          <text class="reminder-label">上次开药:</text>
          <text class="reminder-value">{{prescriptionInfo.lastDate}}</text>
        </view>
        <view class="reminder-item">
          <text class="reminder-label">用药天数:</text>
          <text class="reminder-value">{{prescriptionInfo.lastDays}}天</text>
        </view>
        <view class="reminder-item">
          <text class="reminder-label">下次开药:</text>
          <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{prescriptionInfo.nextDate}}</text>
        </view>
        <view class="reminder-item" wx:if="{{daysRemaining >= 0}}">
          <text class="reminder-label">剩余天数:</text>
          <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{daysRemaining}}天</text>
        </view>
      </view>
    </view>
    
    <!-- 护工/医师处方台账 -->
    <view wx:elif="{{userRole === 'nurse' || userRole === 'doctor' || userRole === 'professional'}}">
      <view class="ledger-header">
        <text class="ledger-title">处方台账</text>
        <text class="ledger-subtitle">最近处方记录</text>
      </view>
      <scroll-view class="ledger-list" scroll-y>
        <block wx:if="{{ledgerList.length > 0}}">
          <view wx:for="{{ledgerList}}" wx:key="index" class="ledger-item">
            <text class="ledger-patient">{{item.patientName}}</text>
            <text class="ledger-date">{{item.prescriptionDate}}</text>
            <text class="ledger-status">{{item.status}}</text>
          </view>
        </block>
        <view wx:else class="empty-ledger">
          <text class="empty-text">暂无处方记录</text>
        </view>
      </scroll-view>
    </view>
  </view>
  
  <!-- 加载中状态 -->
  <view class="role-loading" wx:if="{{isCheckingRole}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 短视频模块 -->
  <view class="video-section">
    <view class="section-header" hidden="true">
      <text class="section-title">热门视频</text>
      <text class="more-link">更多</text>
    </view>
    
    <!-- 横向滚动视频列表 -->
    <scroll-view class="video-scroll-list" scroll-x enable-flex>
      <!-- 视频列表 -->
      <block wx:if="{{videoList.length > 0}}">
        <view wx:for="{{videoList}}" wx:key="id" class="video-item" bindtap="playVideo" data-id="{{item.id}}" data-url="{{item.url}}">
          <view class="video-thumbnail-container">
            <image class="video-thumbnail" src="{{item.thumbnail}}" mode="aspectFill"></image>
            <view class="video-duration">{{item.duration}}</view>
            <view class="play-icon"></view>
          </view>
          <text class="video-title">{{item.title}}</text>
          <text class="video-views">{{item.views}} 次观看</text>
        </view>
      </block>
      
      <!-- 视频列表为空 -->
      <view wx:elif="{{!isVideoLoading}}" class="empty-video-state">
        <text class="empty-video-text">暂无视频数据</text>
      </view>
      
      <!-- 视频加载中 -->
      <view wx:if="{{isVideoLoading}}" class="video-loading">
        <view class="loading-spinner-small"></view>
      </view>
    </scroll-view>
  </view>

  <!-- 文章列表滚动模块 -->
  <view class="article-scroll-section">
    <!-- 已注释掉文章列表标题区域
    <view class="article-scroll-header">
      <view class="section-title">文章列表</view>
    </view>
    -->
    
    <!-- 滚动式文章列表 -->
    <scroll-view class="article-scroll-list" scroll-y enable-flex>
      <!-- 文章列表 -->
      <block wx:if="{{articleList.length > 0}}">
        <view wx:for="{{articleList}}" wx:key="id" class="article-item" bindtap="navigateToArticleDetail" data-id="{{item.id}}">
          <view class="article-content" style="margin-right: 0;">
            <text class="article-title">{{item.title}}</text>
            <text class="article-summary">{{item.summary}}</text>
            <view class="article-meta">
              <text class="article-author">{{item.author}}</text>
              <text class="article-time">{{item.publishTime}}</text>
              <text class="article-reads">{{item.readCount}} 阅读</text>
            </view>
          </view>
        </view>
      </block>
      
      <!-- 空状态 -->
      <view wx:elif="{{!isLoading}}" class="empty-state">
        <text class="empty-text">暂无文章数据</text>
      </view>
      
      <!-- 加载中 -->
      <view wx:if="{{isLoading && articleList.length === 0}}" class="loading-state">
        <view class="loading-spinner"></view>
        <text class="loading-text">加载中...</text>
      </view>
      
      <!-- 加载更多 -->
      <view wx:if="{{isLoading && articleList.length > 0}}" class="loading-more">
        <view class="loading-spinner-small"></view>
        <text class="loading-more-text">加载更多...</text>
      </view>
      
      <!-- 没有更多数据 -->
      <view wx:if="{{!hasMoreData && articleList.length > 0}}" class="no-more-data">
        <text class="no-more-text">没有更多了</text>
      </view>
    </scroll-view>
  </view>

  <!-- 底部信息 -->
  <view class="footer">
    <text class="footer-text">© 2023 文章阅读小程序</text>
  </view>
</view>