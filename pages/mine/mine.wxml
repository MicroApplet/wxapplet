<view class="container">
  <view class="user-info-container">
    <view class="avatar-section">
      <image class="avatar" src="/icons/user-outline.svg" mode="aspectFill"></image>
    </view>
    
    <view class="info-section">
      <view class="nickname-container">
        <text wx:if="{{!isLoading && nickname}}" class="nickname">{{nickname}}</text>
        <text wx:elif="{{!isLoading && !nickname}}" class="no-nickname">未设置昵称</text>
        <text wx:else class="loading">加载中...</text>
      </view>
      
      <button wx:if="{{!isLoading && !nickname}}" class="authorize-btn" bindtap="authorizeUserInfo" open-type="getUserInfo">
        授权获取昵称
      </button>
    </view>
  </view>
  
  <view wx:if="{{!isLoading && nickname}}" class="user-details">
    <view class="detail-item">
      <text class="label">昵称</text>
      <text class="value">{{nickname}}</text>
    </view>
    
    <!-- 实名认证信息 -->
    <view class="detail-item">
      <text class="label">实名认证</text>
      <text wx:if="{{isRealNameVerified}}" class="value verified">已认证</text>
      <button wx:elif="{{!isRealNameVerified}}" class="verify-btn" bindtap="showRealNameForm" type="primary" size="mini">
        去实名认证
      </button>
    </view>
    
    <!-- 已实名认证时显示脱敏信息 -->
    <view wx:if="{{isRealNameVerified && realNameInfo}}" class="real-name-info">
      <view class="detail-item">
        <text class="label">姓名</text>
        <text class="value">{{realNameInfo.name}}</text>
      </view>
      <view class="detail-item">
        <text class="label">证件类型</text>
        <text class="value">{{getCnNameById(realNameInfo.type)}}</text>
      </view>
      <view class="detail-item">
        <text class="label">证件号码</text>
        <text class="value">{{realNameInfo.number}}</text>
      </view>
    </view>
  </view>
  
  <view wx:if="{{!isLoading && !nickname}}" class="empty-state">
    <text class="empty-text">请点击上方按钮授权获取您的昵称信息</text>
  </view>
</view>

<!-- 实名认证表单弹窗 -->
<view wx:if="{{showRealNameForm}}" class="form-modal">
  <view class="modal-backdrop" bindtap="hideRealNameForm"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">实名认证</text>
      <image class="close-btn" src="/icons/x-mark-outline.svg" bindtap="hideRealNameForm"></image>
    </view>
    
    <view class="form-container">
      <!-- 证件类型 -->
      <view class="form-group">
        <text class="form-label">请选择证件类型</text>
        <picker mode="selector" 
                range="{{availableIdCardTypes}}" 
                range-key="cnName" 
                bindchange="onIdTypePickerChange" 
                value="{{idTypePickerIndex}}">
          <view class="form-input">
            <text>{{idTypeCnName || '请选择证件类型'}}</text>
          </view>
        </picker>
      </view>
      
      <!-- 证件姓名 -->
      <view class="form-group">
        <text class="form-label">请输入证件姓名</text>
        <input class="form-input" placeholder="请输入证件姓名" value="{{idName}}" data-field="idName" bindinput="onInput" />
      </view>
      
      <!-- 证件号码 -->
      <view class="form-group">
        <text class="form-label">请输入证件号码</text>
        <input class="form-input" placeholder="请输入证件号码" value="{{idNumber}}" data-field="idNumber" bindinput="onInput" />
      </view>
    </view>
    
    <!-- 人脸认证按钮 -->
    <view wx:if="{{idName && idNumber}}" class="btn-container">
      <button class="face-btn" bindtap="performFaceVerification" type="primary">
        {{isLoading ? '处理中...' : '去认证'}}
      </button>
      <!-- 功能状态提示 -->
      <text class="feature-status-tip">
        系统会自动检测权限并选择合适的认证方式
      </text>
    </view>
    
    <!-- 表单未填写完整提示 -->
    <view wx:elif="{{!isLoading}}" class="form-tip">
      <text>请先填写完整的身份信息</text>
    </view>
  </view>
</view>
