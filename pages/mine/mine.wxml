<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-info-card">
    <view class="user-header">
      <view class="avatar-section">
        <!-- 未授权微信头像时使用默认头像图片 -->
        <image wx:if="{{!avatarUrl}}" class="avatar" src="/images/default_avatar.jpg" mode="aspectFill" bindtap="onAvatarClick"></image>
        <!-- 已授权头像时显示微信头像 -->
        <image wx:elif="{{avatarUrl}}" class="avatar" src="{{avatarUrl}}" mode="aspectFill" bindtap="onAvatarClick"></image>
      </view>
      
      <view class="info-section">
        <!-- 用户信息列表 -->
        <view class="info-list">
          <!-- 1. 微信昵称 -->
          <view class="info-list-item">
            <view class="info-label">昵称</view>
            <view class="info-value">
              <text wx:if="{{nickname}}" class="user-info-text">{{nickname}}</text>
              <button wx:else class="authorize-btn" bindtap="authorizeUserInfo" open-type="getUserInfo" size="mini">
                授权获取昵称
              </button>
            </view>
          </view>
          
          <!-- 2. 授权手机号 -->
          <view class="info-list-item">
            <view class="info-label">手机号</view>
            <view class="info-value">
              <text wx:if="{{phoneAuthorized && phoneNumber}}" class="user-info-text">{{phoneNumber}}</text>
              <button wx:else open-type="getPhoneNumber" bindgetphonenumber="onGetPhoneNumber" class="authorize-btn" size="mini">
                授权手机号
              </button>
            </view>
          </view>
          
          <!-- 3. 实名信息 -->
          <view class="info-list-item">
            <view class="info-label">实名信息</view>
            <view class="info-value">
              <text wx:if="{{isRealNameVerified && realNameInfo && realNameInfo.name}}" class="user-info-text">
                {{realNameInfo.name}} ({{getCnNameById(realNameInfo.type)}}: {{realNameInfo.number}})
              </text>
              <button wx:else class="authorize-btn" bindtap="showRealNameForm" type="primary" size="mini">
                去实名认证
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

<!-- 错误信息显示 -->
<view wx:if="{{errorMsg}}" class="error-message">
  <text>{{errorMsg}}</text>
</view>
  
  <!-- 功能模块列表 -->
  <view class="feature-list" wx:if="{{!isLoading && nickname}}">
    <!-- 用户基本信息 -->
    <view class="feature-section">
      <view class="section-title">账户信息</view>
      <view class="feature-item">
        <view class="item-left">
          <icon class="item-icon" type="user" size="24"></icon>
          <text class="item-label">昵称</text>
        </view>
        <text class="item-value">{{nickname}}</text>
      </view>
      
      <!-- 实名认证信息 -->
      <view class="feature-item">
        <view class="item-left">
          <icon class="item-icon" type="success" size="24" color="{{isRealNameVerified ? '#07c160' : '#666'}}"></icon>
          <text class="item-label">实名认证</text>
        </view>
        <view class="item-right">
          <text wx:if="{{isRealNameVerified}}" class="value verified">已认证</text>
          <button wx:elif="{{!isRealNameVerified}}" class="verify-btn" bindtap="showRealNameForm" type="primary" size="mini">
            去实名认证
          </button>
        </view>
      </view>
    </view>
    
    <!-- 已实名认证时显示脱敏信息 -->
    <view class="feature-section" wx:if="{{isRealNameVerified && realNameInfo}}">
      <view class="section-title">认证详情</view>
      <view class="feature-item">
        <view class="item-left">
          <icon class="item-icon" type="info" size="24"></icon>
          <text class="item-label">姓名</text>
        </view>
        <text class="item-value">{{realNameInfo.name}}</text>
      </view>
      <view class="feature-item">
        <view class="item-left">
          <icon class="item-icon" type="info" size="24"></icon>
          <text class="item-label">证件类型</text>
        </view>
        <text class="item-value">{{getCnNameById(realNameInfo.type)}}</text>
      </view>
      <view class="feature-item">
        <view class="item-left">
          <icon class="item-icon" type="info" size="24"></icon>
          <text class="item-label">证件号码</text>
        </view>
        <text class="item-value">{{realNameInfo.number}}</text>
      </view>
    </view>
  
    <!-- 其他功能 -->
    <view class="feature-section">
      <view class="section-title">其他功能</view>
      <view class="feature-item" bindtap="goToLogs">
        <view class="item-left">
          <icon class="item-icon" type="success_no_circle" size="24"></icon>
          <text class="item-label">日志记录</text>
        </view>
        <view class="arrow-icon">→</view>
      </view>
      <view class="feature-item" bindtap="logout">
        <view class="item-left">
          <icon class="item-icon" type="clear" size="24" color="#f5222d"></icon>
          <text class="item-label logout-text">退出登录</text>
        </view>
        <view class="arrow-icon">→</view>
      </view>
    </view>
  </view>
  
<!-- 实名认证表单弹窗 -->
<view wx:if="{{showRealNameForm}}" class="form-modal">
  <view class="modal-backdrop" bindtap="hideRealNameForm"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">实名认证</text>
      <view class="close-btn" bindtap="hideRealNameForm">×</view>
    </view>
    
    <view class="form-container">
      <!-- 证件类型 -->
      <view class="form-group">
        <text class="form-label">请选择证件类型</text>
        <picker mode="selector" 
                range="{{availableIdCardTypes}}" 
                range-key="cnName" 
                bindchange="onIdTypePickerChange" 
                value="{{idTypePickerIndex}}">
          <view class="form-input">
            <text>{{idTypeCnName || '请选择证件类型'}}</text>
          </view>
        </picker>
      </view>
      
      <!-- 证件姓名 -->
      <view class="form-group">
        <text class="form-label">请输入证件姓名</text>
        <input class="form-input" placeholder="请输入证件姓名" value="{{idName}}" data-field="idName" bindinput="onInput" />
      </view>
      
      <!-- 证件号码 -->
      <view class="form-group">
        <text class="form-label">请输入证件号码</text>
        <input class="form-input" placeholder="请输入证件号码" value="{{idNumber}}" data-field="idNumber" bindinput="onInput" />
      </view>
    </view>
    
    <!-- 人脸认证按钮 -->
    <view wx:if="{{idName && idNumber}}" class="btn-container">
      <button class="face-btn" bindtap="performFaceVerification" type="primary">
        {{isLoading ? '处理中...' : '去认证'}}
      </button>

    </view>
    
    <!-- 表单未填写完整提示 -->
    <view wx:elif="{{!isLoading}}" class="form-tip">
      <text>请先填写完整的身份信息</text>
    </view>
  </view>
</view>
</view>
