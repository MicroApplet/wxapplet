<!--clinc.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 无权限提示 -->
  <view wx:elif="{{!hasPermission}}" class="no-permission-container">
    <view class="no-permission-icon">🔒</view>
    <text class="no-permission-text">您没有权限查看此内容</text>
  </view>

  <!-- 正常内容 -->
  <view wx:else class="content-container">


    <!-- 处方信息区域 -->
    <view class="prescription-section">
      <view class="section-header">
        <text class="section-title">{{isProfessionalUser ? '处方提醒列表' : '我的处方提醒'}}</text>
        <view wx:if="{{isProfessionalUser}}" class="header-right">
          <!-- 搜索按钮 -->
          <button wx:if="{{!showSearchOptions}}" class="search-btn" bindtap="showSearchOptions">搜索</button>
          
          <!-- 搜索选项下拉表 -->
          <view wx:if="{{showSearchOptions}}" class="search-options">
            <view class="option-item" bindtap="selectSearchOption" data-type="name">姓名</view>
            <view class="option-item" bindtap="selectSearchOption" data-type="idNo">证件号</view>
            <view class="option-item" bindtap="selectSearchOption" data-type="phone">手机号</view>
            <view class="option-item" bindtap="selectSearchOption" data-type="none">取消搜索</view>
          </view>
          
          <!-- 搜索输入区域 -->
          <view wx:if="{{showSearchInput}}" class="search-input-container">
            <input class="search-input" 
                   placeholder="请输入{{selectedSearchType === 'name' ? '姓名' : selectedSearchType === 'idNo' ? '证件号' : '手机号'}}" 
                   value="{{searchValue}}" 
                   bindinput="onSearchInput" />
            <button class="search-confirm-btn" bindtap="confirmSearch">确认</button>
            <button class="search-cancel-btn" bindtap="cancelSearch">取消</button>
          </view>
          
          <text class="total-count">共 {{pagination.total}} 条记录</text>
        </view>
      </view>

      <!-- 处方记录表格 -->
      <view class="prescription-table-container">
        <!-- 表格表头 -->
        <view class="table-header">
          <view class="table-cell">上次日期</view>
          <view class="table-cell">处方天数</view>
          <view class="table-cell">下次日期</view>
          <view class="table-cell">剩余天数</view>
        </view>
        
        <!-- 表格内容区域 -->
        <view class="table-body">
          <view wx:if="{{prescriptionData.length === 0}}" class="empty-state">
            <text class="empty-text">暂无处方记录</text>
          </view>
          
          <block wx:for="{{prescriptionData}}" wx:key="index">
            <view class="table-row {{isProfessionalUser ? 'clickable' : ''}}" bindtap="{{isProfessionalUser ? 'onRowClick' : ''}}" data-phone="{{item.phone}}">
              <view class="table-cell">{{item.lastDate}}</view>
              <view class="table-cell">{{item.lastDays}} 天</view>
              <view class="table-cell">{{item.nextDate}}</view>
              <view class="table-cell {{item.remainingDays <= 3 ? 'warning-text' : ''}}">
                {{item.remainingDays}} 天
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- 加载更多 -->
      <view wx:if="{{loadingMore}}" class="loading-more">
        <text>加载更多...</text>
      </view>
      
      <view wx:if="{{noMoreData && prescriptionData.length > 0}}" class="no-more">
        <text>没有更多数据了</text>
      </view>
    </view>
  </view>
</view>