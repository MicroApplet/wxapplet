<!--clinc.wxml-->
<view class="container">
  <!-- 用药提醒/处方台账模块 -->
  <view class="prescription-reminder" wx:if="{{showPrescriptionModule}}">
    <!-- 超管/管理员/同时拥有两种权限的用户，同时显示两个模块 -->
    <view wx:if="{{showBothModules}}">
      <!-- 普通用户用药提醒 -->
      <view class="prescription-reminder-inner">
        <view class="reminder-header">
          <text class="reminder-title">用药提醒</text>
          <text class="reminder-subtitle">即将到用药时间</text>
        </view>
        <view class="reminder-content">
          <view class="reminder-item">
            <text class="reminder-label">上次开药:</text>
            <text class="reminder-value">{{prescriptionInfo.lastDate}}</text>
          </view>
          <view class="reminder-item">
            <text class="reminder-label">用药天数:</text>
            <text class="reminder-value">{{prescriptionInfo.lastDays}}天</text>
          </view>
          <view class="reminder-item">
            <text class="reminder-label">下次开药:</text>
            <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{prescriptionInfo.nextDate}}</text>
          </view>
          <view class="reminder-item" wx:if="{{daysRemaining >= 0}}">
            <text class="reminder-label">剩余天数:</text>
            <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{daysRemaining}}天</text>
          </view>
        </view>
      </view>
      
      <!-- 护工/医师处方台账 -->
      <view class="prescription-reminder-inner">
        <view class="ledger-header">
          <text class="ledger-title">处方台账</text>
          <text class="ledger-subtitle">最近处方记录</text>
        </view>
        <scroll-view class="ledger-list" scroll-y>
          <block wx:if="{{ledgerList.length > 0}}">
            <view wx:for="{{ledgerList}}" wx:key="index" class="ledger-item">
              <text class="ledger-patient">{{item.patientName}}</text>
              <text class="ledger-date">{{item.prescriptionDate}}</text>
              <text class="ledger-status">{{item.status}}</text>
            </view>
          </block>
          <view wx:else class="empty-ledger">
            <text class="empty-text">暂无处方记录</text>
          </view>
        </scroll-view>
      </view>
    </view>
    
    <!-- 普通用户用药提醒 -->
    <view wx:elif="{{userRole === 'normal' || userRole === 'idCard'}}">
      <view class="reminder-header">
        <text class="reminder-title">用药提醒</text>
        <text class="reminder-subtitle">即将到用药时间</text>
      </view>
      <view class="reminder-content">
        <view class="reminder-item">
          <text class="reminder-label">上次开药:</text>
          <text class="reminder-value">{{prescriptionInfo.lastDate}}</text>
        </view>
        <view class="reminder-item">
          <text class="reminder-label">用药天数:</text>
          <text class="reminder-value">{{prescriptionInfo.lastDays}}天</text>
        </view>
        <view class="reminder-item">
          <text class="reminder-label">下次开药:</text>
          <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{prescriptionInfo.nextDate}}</text>
        </view>
        <view class="reminder-item" wx:if="{{daysRemaining >= 0}}">
          <text class="reminder-label">剩余天数:</text>
          <text class="reminder-value" style="color: {{daysRemaining < 3 ? '#e64340' : ''}}">{{daysRemaining}}天</text>
        </view>
      </view>
    </view>
    
    <!-- 护工/医师处方台账 -->
    <view wx:elif="{{userRole === 'nurse' || userRole === 'doctor' || userRole === 'professional'}}">
      <view class="ledger-header">
        <text class="ledger-title">处方台账</text>
        <text class="ledger-subtitle">最近处方记录</text>
      </view>
      <scroll-view class="ledger-list" scroll-y>
        <block wx:if="{{ledgerList.length > 0}}">
          <view wx:for="{{ledgerList}}" wx:key="index" class="ledger-item">
            <text class="ledger-patient">{{item.patientName}}</text>
            <text class="ledger-date">{{item.prescriptionDate}}</text>
            <text class="ledger-status">{{item.status}}</text>
          </view>
        </block>
        <view wx:else class="empty-ledger">
          <text class="empty-text">暂无处方记录</text>
        </view>
      </scroll-view>
    </view>
  </view>
  
  <!-- 加载中状态 -->
  <view class="role-loading" wx:if="{{isCheckingRole}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 未登录或无权限状态 -->
  <view class="no-permission" wx:if="{{!showPrescriptionModule && !isCheckingRole}}">
    <text class="no-permission-text">您暂无权限查看此页面</text>
  </view>

  <!-- 底部信息 -->
  <view class="footer">
    <text class="footer-text">© 2023 文章阅读小程序</text>
  </view>
</view>